本番DBのデータ修正は基本的には (Choose one) （編集済み） 
Results (48 voters):
████████ (24) rake task書いて実行
████ (12) Rails consoleから修正
██ (6) DBつないでSQL実行
█ (4) その他
█ (2) Abstain
:拍手:
1


ttanimichi  23:40
Rails.env.production で rails console 起動したら warning 表示したほうが良いくらいなのでは...? :考え中:
23:43
まず本番環境で実行する前にコードレビューしますね
23:44
rake task なり SQL の

hanachin  23:51
ARのcallback実行する必要があるかどうかの違いが一番大きそう
23:52
その他: rails runner（consoleとほぼいっしょ?） （編集済み） 

ginkouno  23:54
1)rake taskを書く -> 2)developmentでの実行結果を貼り付ける -> 1),2)をレビュー -> stgでの試行が可能ならstgで実施 -> 問題なければproductionで実施(可能ならペア作業
23:54
とかですかねー
:kannzenndoui:
4


sinsoku  00:38
基本はmigrationを使ってますね。rake taskだと実行有無でmigrationが途中で失敗するようになったりするので。 （編集済み） 

ohbarye:github_octocat:  00:41
vote投稿した者です :挙手_男性:
今更ながら以下の選択肢も足しておけばよかったか
db/migrateでやる
data_migrate gemのような何らかのdata migrationをサポートするツールを使う

pocke:pocke:  01:35
migrateでやりたい派の人って、DBが絡まないデータ変更(例えばStripeのAPIを叩いてデータを直したい)や、本番でしか実行しないケース(例えばuser Aのデータだけ直したい)みたいな時ってどうしているんでしょうか。
その場合もmigration or その場合は別の手段?
:kininaru:
1


sinsoku  02:12
基本はmigrationで、それ以外のケースはrakeタスクかな。
レビューできて、コミットログが残るので。

genya0407  14:11
本番DBのデータ修正って、CSのオペレーションとかで修正することを指してるのか、バグったときに直すのを指してるのかどっちなんでしょう？

ohbarye:github_octocat:  14:22
後者のバグったときに直す、一時的な作業をイメージしてました
14:24
（定期的に行ったり、ある程度柔軟性が必要だったりするデータ修正は画面とかで機能として提供するだろう、という考え）
:wakaru:
1


tsugimoto  17:05
＼状況次第／
:sorena:
3


ohbarye:github_octocat:  17:11
状況次第 <- 緊急時（1時間以内の修正が必要とか）であれば普段と違うやり方することもある、みたいなイメージですかね :両目: （それとも緊急度に関係なく修正する内容次第で使い分け？）

koheisg  17:18
ある程度柔軟性が必要だったりするデータ修正は画面とかで機能として提供する
ばりばりスタートアップだと、この前提とかなかったりするので、rails consoleばりばり活躍すると思うんですけれど、
こういうのは麻薬なので、どこかの段階でちゃんとした運用に昇華しないといけないと、バス因子が生まれるやつですね。。。
やらなくちゃいけないけれど、あえてやらないみたいなのはなしではないと思います。
上場企業とかだと監査上ログが残らない操作はあってはいけないでしょうけど。
:wakaru:
1
:sorena:
1

17:20
僕自身スタートアップの2人目以降のエンジニアの何度か経験はあるんですけれど、
1人目のエンジニアに文化はめっちゃ左右されるので、1人目のエンジニアがそういうことに興味ないと全然整備されてないし、整備していこうという機運も生まれにくいですけど、
1人目のエンジニアがちゃんとしていきたい人だと、2人目以降のエンジニア(僕)が「こうあるべき」とか言わなくていい気がします。
(あと、1人目があえてログとかをいい加減にやってる場合と、やらなくていいと思っていて知らない場合でだいぶ違います) （編集済み） 
:wakarimi:
2


shishi  17:24
最初に書き始めた誰かがはやくつくるためとか、考慮されるパターンが少なかったとかそういうんじゃなくて何も考えてないだけの例をいくつも見てきてうおおおおおおおkdjfkadjfklfkljfjdkj(言葉にならない言葉) というのはよくある （編集済み） 
:wakaru:
1


genya0407  17:24
状況次第
DBの値をサッと書き換えたら収束するバグってそんなに無い気がしてて、なので手動DB書き換えはあんまりしないのかな...
17:24
本当に緊急時だったらメンテナンス入れちゃってコード直すとか？

koheisg  17:25
消したらいけないデータを消してしまって復旧させたい。
運良く？削除フラグ運用されていて、さっと戻すだけおっけーだった。とか？
17:26
めっちゃレアケースだしそれで戻して問題にならないレベルの規模のシステムって感じですね。。

genya0407  17:26
ありそうな気がしつつ
削除フラグ運用されていて、さっと戻すだけおっけー
が本当におっけーという確信を持つのは大変そう

koheisg  17:27
スタートアップの場合戻してみて問題が出たら考えるって感じですね。
:力こぶ:
1

17:29
ちなみにばりばりのスタートアップで結構危ない処理を秘伝のパッチコードでrails consoleで流す運用をしていて、できる人が限られてて困るみたいなのが出てきてからrake taskに切り出したみたいなのありましたね。
17:32
あとmigrationは少数派な気もするけれど、デプロイ機構さえ整っていればどこでも使えるので、
スタートアップでコードに残してレビューする運用を今から始められる！という意味で便利かもしれないですね。
cronに乗ってないrake taskをどこで動かすか？みたいなの議論する余地がないので。

tsugimoto  01:02
エンジニアが１人しかいないとコードレビューをできる運用をしたところでコードレビューできるわけではありませんからねぇ
そういう意味ではプロジェクトがでっかくなるほどちゃんとしたやり方に徐々に移行していって、廃課金ユーザーがログインできないって問い合わせてくるソシャゲみたいなケースでは別途考える感じに
01:03
まあ自分は本番環境の rails console でデータ修正とか絶対したくないですけど（働きたくないのイントネーションで）
:wakarite:
3


ttanimichi  08:52
本番環境で rails console 派の人って、それ irb が起動するんですかね？pry とか pry-byebug の group を development, test に限定していないということ...?
08:54
デバッグツールって本番環境で読み込まれることを想定せずに作られてるだろうから性能劣化したり想定外のバグ踏む可能性とかありそうで怖いかな...

suusan2go  09:08
昔いた会社だと、運用用のサーバにrails consoleをラップしたCLIがおいてあってそれ叩くと全操作がログに記録されるみたいになっていたことを思い出しました :苦笑い:
:yosasou:
6
:koukaisyuuroku:
1


ttanimichi  09:15
そういうプラグインの gem 作ったら需要ありそうで良いですね（良くない）

tsugimoto  09:25
藁人形論法ｲｸﾅｲ

sinsoku  09:28
そもそも、rails consoleの操作がlogに残る機能が公式にあれば良い気もした。
09:29
あー、でも誰の操作かはrailsからは分からないか。

wakaba260  14:18
監査対策としてシェルの履歴をとるかどうか、みたいな話を思い出しました

koheisg  17:16
rails console派ではないんですけれど、まぁそういうことやるならirbでやってましたね。本番環境にはpry入ってないので