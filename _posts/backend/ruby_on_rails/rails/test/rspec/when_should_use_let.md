RSpecのletを使うのはどんなときか？（翻訳）



私は以下のような理由からインスタンス変数ではなくletをいつも使っています。

# 1. typoにすぐ気づける
インスタンス変数は参照された瞬間に生成されます。
これが問題になるのはインスタンス変数の名前をtypoしたときです。
typoすると新しいインスタンス変数が生成されてnilで初期化されます。
これはわかりにくいバグや、パスすべきでないテストがパスする問題（false positive）につながります。

letはメソッドを作るのでtypoするとNameErrorが発生します。
本来であればこちらの動きの方が望ましいでしょう。
また、このような特性（訳注：テストコードの問題をすぐ検知できること）を持つのでテストのリファクタリングもしやすくなります。

# 2. 無駄な初期化の時間を無くせる
before(:each)フックは各exampleの前に実行されます。
その際、exampleで使われないインスタンス変数があっても、before(:each)フックの中で定義されていればその変数が生成されます。
ほとんどのケースではこれは大した問題になりませんが、 もしインスタンス変数のセットアップに長い時間がかかるのであれば、毎回無駄な時間を食うことになります。

一方、 letで定義されたメソッドを使うと、初期化処理が実行されるのはそのメソッドが呼ばれたときだけ です。

# 3. ローカル変数をそのままletに置き換えられる
exampleの中でローカル変数を使っている場合、 シンタックスを変更することなくそのままletを使ったコードにリファクタリングできます。

一方、 インスタンス変数を使うようにリファクタリングすると、参照方法を変更する必要が出てきます。 （例：@を付ける）

# 4. letを使った方が読みやすい
これはちょっと主観的な話になりますが、Mike Lewis氏（訳注：別の回答者）も述べているように、 let を使った方がテストが読みやすくなる と思います。
テストが依存するオブジェクトはすべてletを使って整理し、itブロックの中のコードは短くスッキリさせるのが私の好みです。

https://qiita.com/jnchito/items/cdd9eef2ed193267c651